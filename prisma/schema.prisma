generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
model User {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username   String   @unique
  email      String   @unique
  password   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©
  bio        String?
  botName    String?

  // Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
  role       Role     @default(USER) // USER Ø£Ùˆ ADMIN
  blocked    Boolean  @default(false) // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­Ø¸ÙˆØ±

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  bots          Bot[]         @relation("UserBots")
  conversations Conversation[]
}

// ğŸ¤– Ø§Ù„Ø¨ÙˆØª
model Bot {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  description String
  image       String?
  personality String?
  isPublic    Boolean  @default(true)
  creatorId   String?  @db.Uuid
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  accent      String?
  apiKey      String?
  topEntry TopBot? @relation("TopRank")
}


  // Ø§Ù„ØªØµÙ†ÙŠÙ
  categoryId String? @db.Uuid
  category    Category? @relation(fields: [categoryId], references: [id])

  // Ø¹Ù„Ø§Ù‚Ø§Øª
  creator     User?    @relation("UserBots", fields: [creatorId], references: [id])
  conversations Conversation[] @relation("BotConversations")
}

// ğŸ—‚ï¸ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (Adventure - Role-play - Horror ...)
model Category {
  id    String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name  String  @unique
  bots  Bot[]
}

// ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
model Conversation {
  id        String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String       @db.Uuid
  botId     String?      @db.Uuid
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  title     String?

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  user      User         @relation(fields: [userId], references: [id])
  bot       Bot?         @relation("BotConversations", fields: [botId], references: [id])
  messages  Message[]
}

// ğŸ“© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
model Message {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  conversationId String       @db.Uuid
  sender         String       // "user" Ø£Ùˆ "bot"
  text           String
  createdAt      DateTime     @default(now())

  conversation   Conversation  @relation(fields: [conversationId], references: [id])
}

// ğŸ·ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ Ø£Ùˆ Ø£Ø¯Ù…Ù†)
enum Role {
  USER
  ADMIN
}
/// ğŸ† Ø£ÙØ¶Ù„ 10 Ø¨ÙˆØªØ§Øª (Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø± Ø§Ù„Ø£Ø®ÙŠØ± Ù‡Ùˆ Ø±Ù‚Ù… 10)
model TopBot {
  id    Int    @id @default(autoincrement())
  rank  Int    @unique          // 1-10
  botId String @unique @db.Uuid // ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Bot
  bot    Bot    @relation("TopRank", fields: [botId], references: [id])
}

